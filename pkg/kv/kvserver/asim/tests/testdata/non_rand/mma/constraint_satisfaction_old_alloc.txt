# specify zone survivability (2, 2, 1) replicas across 3 regions.
# a(n1.n2) b(n3,n4) c(n5) d(n6-n9)
gen_cluster nodes=9 region=(a,b,c,d) nodes_per_region=(3,2,1,3) node_cpu_rate_capacity=5000000000
----

# specify non-voters
# (s1-3: region a) (s4-5: region b) (s6: region c) (s7-9: region d)
# ratio (region1:2, region2:2, region3: 1)

# load -> for region a, have load

# replica_weights=(0.2,0.2,0.2,0.2,0.1,0.1,0,0,0)
gen_ranges ranges=100 repl_factor=5 placement_type=replica_placement
{s1,s2,s4,s5,s6}:1
----
{s1:*,s2,s4,s5,s6}:1

gen_load rate=2000 rw_ratio=0.95 min_block=1000 max_block=1000 request_cpu_per_access=1000000 raft_cpu_per_write=10000
----

set_span_config
[0,9999999999): num_replicas=5 num_voters=5 constraints={'+region=a':2,'+region=b':2,'+region=c':1} lease_preferences=[['+region=a']]
----

eval duration=60m samples=1 seed=42 metrics=(cpu,cpu_util,leases,replicas) cfgs=(sma-count,mma-only,mma-count)
----
cpu#1: last:  [s1=720695690, s2=660948514, s3=620876674, s4=1000200, s5=1000200, s6=1000200, s7=0, s8=0, s9=0] (stddev=315320690.23, mean=222835719.78, sum=2005521478)
cpu#1: thrash_pct: [s1=10%, s2=11%, s3=33%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=55%)
cpu_util#1: last:  [s1=0.14, s2=0.13, s3=0.12, s4=0.00, s5=0.00, s6=0.00, s7=0.00, s8=0.00, s9=0.00] (stddev=0.06, mean=0.04, sum=0)
cpu_util#1: thrash_pct: [s1=10%, s2=11%, s3=33%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=55%)
leases#1: first: [s1=100, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=31.43, mean=11.11, sum=100)
leases#1: last:  [s1=36, s2=33, s3=31, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=15.76, mean=11.11, sum=100)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=19%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=19%)
replicas#1: first: [s1=100, s2=100, s3=0, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=49.69, mean=55.56, sum=500)
replicas#1: last:  [s1=68, s2=67, s3=65, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=41.58, mean=55.56, sum=500)
replicas#1: thrash_pct: [s1=8%, s2=8%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=16%)
artifacts[sma-count]: cdf1ff0e1ae775f8
==========================
cpu#1: last:  [s1=720153994, s2=641630215, s3=640793875, s4=1000123, s5=1000123, s6=1000123, s7=0, s8=0, s9=0] (stddev=315172560.19, mean=222842050.33, sum=2005578453)
cpu#1: thrash_pct: [s1=7%, s2=23%, s3=23%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=54%)
cpu_util#1: last:  [s1=0.14, s2=0.13, s3=0.13, s4=0.00, s5=0.00, s6=0.00, s7=0.00, s8=0.00, s9=0.00] (stddev=0.06, mean=0.04, sum=0)
cpu_util#1: thrash_pct: [s1=7%, s2=23%, s3=23%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=54%)
leases#1: first: [s1=100, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=31.43, mean=11.11, sum=100)
leases#1: last:  [s1=36, s2=32, s3=32, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=15.75, mean=11.11, sum=100)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=0%)
replicas#1: first: [s1=100, s2=100, s3=0, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=49.69, mean=55.56, sum=500)
replicas#1: last:  [s1=68, s2=100, s3=32, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=44.56, mean=55.56, sum=500)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=0%)
artifacts[mma-only]: 8dde7a58c40b7fda
==========================
cpu#1: last:  [s1=721438744, s2=620272189, s3=660901249, s4=1000465, s5=1000465, s6=1000465, s7=0, s8=0, s9=0] (stddev=315359062.48, mean=222845953.00, sum=2005613577)
cpu#1: thrash_pct: [s1=10%, s2=16%, s3=35%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=62%)
cpu_util#1: last:  [s1=0.14, s2=0.12, s3=0.13, s4=0.00, s5=0.00, s6=0.00, s7=0.00, s8=0.00, s9=0.00] (stddev=0.06, mean=0.04, sum=0)
cpu_util#1: thrash_pct: [s1=10%, s2=16%, s3=35%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=62%)
leases#1: first: [s1=100, s2=0, s3=0, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=31.43, mean=11.11, sum=100)
leases#1: last:  [s1=36, s2=31, s3=33, s4=0, s5=0, s6=0, s7=0, s8=0, s9=0] (stddev=15.76, mean=11.11, sum=100)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=15%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=15%)
replicas#1: first: [s1=100, s2=100, s3=0, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=49.69, mean=55.56, sum=500)
replicas#1: last:  [s1=66, s2=69, s3=65, s4=100, s5=100, s6=100, s7=0, s8=0, s9=0] (stddev=41.59, mean=55.56, sum=500)
replicas#1: thrash_pct: [s1=6%, s2=6%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%]  (sum=11%)
artifacts[mma-count]: b11aaae48dded43a
==========================
